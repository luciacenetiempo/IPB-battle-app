(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[708],{767:(e,a,r)=>{"use strict";r.r(a),r.d(a,{default:()=>o});var n=r(7876),t=r(4232),s=r(6932),i=r(5940),c=r(2601),l=r.n(c);function o(){let[e,a]=(0,t.useState)(null),[r,c]=(0,t.useState)({}),o=(0,t.useRef)({});(0,t.useEffect)(()=>{let e=(0,i.KR)(s.db,"gameState"),r=(0,i.Zy)(e,e=>{let r=e.val();r&&a(r)}),n=(0,i.KR)(s.db,"participants"),t=(0,i.Zy)(n,e=>{let a=e.val()||{};console.log("[SCREEN] Participants update received:",a),console.log("[SCREEN] Participant IDs:",Object.keys(a)),Object.entries(a).forEach(e=>{var a;let[r,n]=e;console.log("[SCREEN] Participant ".concat(r,":"),{name:n.name,prompt:(null==(a=n.prompt)?void 0:a.substring(0,20))+"...",hasImage:!!n.image,imageUrl:n.image})}),c(a)});return()=>{r(),t()}},[]);let[d,_]=(0,t.useState)(0);if((0,t.useEffect)(()=>{if(!e)return;let a=setInterval(()=>{if("WRITING"===e.status&&e.startTime){let a=Math.floor((Date.now()-e.startTime)/1e3);_(Math.max(0,e.duration-a))}else if("VOTING"===e.status&&e.votingTimerStartTime){let a=Math.max(0,120-Math.floor((Date.now()-e.votingTimerStartTime)/1e3));_(a),0===a&&"VOTING"===e.status&&(0,i.yo)((0,i.KR)(s.db,"gameState"),{status:"ENDED"})}else"VOTING"===e.status?_(e.votingTimer||0):_(e.timer||0)},1e3);return()=>clearInterval(a)},[e]),(0,t.useEffect)(()=>{if(!e||"WRITING"!==e.status&&"GENERATING"!==e.status)return;let a=[];return Object.entries(r).forEach(e=>{let[r,n]=e,t=o.current[r];if(t){let e=setTimeout(()=>{requestAnimationFrame(()=>{t.scrollTo({top:t.scrollHeight,behavior:"smooth"})})},100);a.push(e)}}),()=>{a.forEach(e=>clearTimeout(e))}},[r,null==e?void 0:e.status]),!e)return(0,n.jsx)("div",{className:l().loading,children:"INITIALIZING..."});let m=Object.entries(r),g="VOTING"===e.status||"ENDED"===e.status,u=m.length,p=4===u;return(0,n.jsxs)("div",{className:l().container,children:[!p&&(0,n.jsxs)("div",{className:l().themeHeader,children:[(0,n.jsxs)("span",{className:l().roundLabel,children:["ROUND ",e.round]}),e.theme&&(0,n.jsx)("h1",{className:"".concat(l().theme," glitch"),"data-text":e.theme,children:e.theme})]}),(0,n.jsx)("div",{className:"".concat(l().grid," ").concat(2===u?l().gridTwo:l().gridFour),children:m.map(a=>{let[t,s]=a,i=Object.values(r).reduce((e,a)=>e+(a.votes||0),0)||1,c=g?(s.votes||0)/i*100:0;return(0,n.jsxs)("div",{className:l().card,style:{backgroundColor:s.color||"#B6FF6C"},children:[(0,n.jsxs)("div",{className:l().cardContent,ref:e=>{e&&(o.current[t]=e)},children:["WRITING"===e.status&&(0,n.jsxs)("div",{className:l().promptDisplay,children:[s.prompt||"",(0,n.jsx)("span",{className:l().cursor})]}),"GENERATING"===e.status&&(0,n.jsxs)("div",{className:l().generatingWrapper,children:[!s.image&&(0,n.jsxs)("div",{className:l().generatingBadge,children:[(0,n.jsx)("div",{className:l().generatingSpinner}),(0,n.jsx)("span",{children:"GENERATING..."})]}),s.image?(0,n.jsx)("div",{className:l().imageContainer,children:(0,n.jsx)("img",{src:s.image,alt:"Generated image for ".concat(s.name),className:l().image})}):(0,n.jsx)("div",{className:l().imageContainer,children:(0,n.jsx)("div",{className:l().placeholder,children:"GENERATING..."})})]}),g&&(0,n.jsx)("div",{className:l().imageContainer,children:s.image?(0,n.jsx)("img",{src:s.image,alt:"Generated image for ".concat(s.name),className:l().image}):(0,n.jsx)("div",{className:l().placeholder,children:"IMAGE_READY"})})]}),(0,n.jsx)("div",{className:l().cardFooter,children:s.name}),g&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("div",{className:l().voteOverlay,style:{height:"".concat(c,"%")}}),c>0&&(0,n.jsxs)("div",{className:l().votePercentage,children:[Math.round(c),"%"]})]})]},t)})}),!p&&(0,n.jsx)("div",{className:l().timerFooter,children:(0,n.jsxs)("div",{className:l().timer,children:[d,(0,n.jsx)("span",{className:l().timerUnit,children:"s"})]})}),"ENDED"===e.status&&(()=>{var e;let a=null==(e=m.sort((e,a)=>{var r,n;return((null==(r=a[1])?void 0:r.votes)||0)-((null==(n=e[1])?void 0:n.votes)||0)})[0])?void 0:e[1];return(0,n.jsxs)("div",{className:l().winnerOverlay,children:[(null==a?void 0:a.image)&&(0,n.jsx)("div",{className:l().winnerImageBackground,style:{backgroundImage:"url(".concat(a.image,")")}}),(0,n.jsxs)("div",{className:l().winnerOverlayDark,children:[(0,n.jsx)("h1",{className:"".concat(l().winnerTitle," glitch"),"data-text":"WINNER",children:"WINNER"}),(0,n.jsx)("h2",{className:l().winnerName,children:(null==a?void 0:a.name)||"No Winner"})]})]})})()]})}},2601:e=>{e.exports={loading:"Screen_loading__lUx_w",container:"Screen_container__EyY5Q",themeHeader:"Screen_themeHeader__zP4Q6",roundLabel:"Screen_roundLabel__wdhjQ",theme:"Screen_theme__xnIUk",timerFooter:"Screen_timerFooter__4hTdA",timer:"Screen_timer__eCF1h",timerUnit:"Screen_timerUnit__LINGH",grid:"Screen_grid__vpyA7",gridTwo:"Screen_gridTwo__X8hhX",gridFour:"Screen_gridFour__yfOXK",card:"Screen_card__IJQzW",cardHeader:"Screen_cardHeader__SGsFu",votes:"Screen_votes__aSUyq",cardFooter:"Screen_cardFooter__O1AIi",cardContent:"Screen_cardContent__LtX8I",generatingWrapper:"Screen_generatingWrapper__DiVEn",promptSmall:"Screen_promptSmall__6e2lj",promptDisplay:"Screen_promptDisplay__EgIB8",generatingBadge:"Screen_generatingBadge__nsT_6",generatingSpinner:"Screen_generatingSpinner__vYRHN",spin:"Screen_spin__VuF_g",imagePreview:"Screen_imagePreview__XoLAE",image:"Screen_image__8DPmg",cursor:"Screen_cursor__0T2TW",blink:"Screen_blink__X54vn",imageContainer:"Screen_imageContainer__Uscga",placeholder:"Screen_placeholder__4nyHh",pulse:"Screen_pulse__4o9b7",voteOverlay:"Screen_voteOverlay__D15to",votePercentage:"Screen_votePercentage__bDbcX",winnerOverlay:"Screen_winnerOverlay__0gkKU",fadeIn:"Screen_fadeIn__tfznt",winnerImageBackground:"Screen_winnerImageBackground__zVQzi",winnerOverlayDark:"Screen_winnerOverlayDark__Emix2",winnerTitle:"Screen_winnerTitle__mVqFE",winnerName:"Screen_winnerName__J2Jlm"}},5401:(e,a,r)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/screen",function(){return r(767)}])},6932:(e,a,r)=>{"use strict";r.d(a,{db:()=>i});var n=r(6042),t=r(5940);let s=0===(0,n.Dk)().length?(0,n.Wp)({apiKey:"AIzaSyBxaJXxnRMJ2mhIrdwkhw-JRw0U1KI-z2o",authDomain:"ipbapp-5e085.firebaseapp.com",databaseURL:"https://ipbapp-5e085-default-rtdb.europe-west1.firebasedatabase.app",projectId:"ipbapp-5e085",storageBucket:"ipbapp-5e085.firebasestorage.app",messagingSenderId:"755522709316",appId:"1:755522709316:web:e35e3d9b96debc93955911"}):(0,n.Dk)()[0],i=(0,t.C3)(s)}},e=>{e.O(0,[280,76,636,593,792],()=>e(e.s=5401)),_N_E=e.O()}]);